<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 03: Geodesy & Projections | GIS Digital Textbook</title>
    <meta name="description" content="Explore the science of measuring Earth and the art of map projections. Learn about datums, coordinate systems, and the 'Orange Peel' problem.">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6366f1;
            --secondary: #64748b;
            --accent: #f43f5e;
            --success: #10b981;
            --bg: #f8fafc;
        }

        .hero-chapter {
            background: linear-gradient(135deg, #1e1b4b 0%, #6366f1 100%);
            padding: 5rem 2rem;
            text-align: center;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .hero-chapter::before {
            content: "";
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background-image: radial-gradient(circle at 50% 120%, rgba(255,255,255,0.1) 0%, transparent 60%);
        }

        .chapter-badge {
            display: inline-block;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(4px);
            padding: 0.5rem 1.5rem;
            border-radius: 999px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 1.5rem;
            border: 1px solid rgba(255,255,255,0.3);
        }

        h1 { font-size: clamp(2.5rem, 5vw, 4rem); margin-bottom: 1rem; }
        .subtitle { font-size: 1.25rem; opacity: 0.9; max-width: 800px; margin: 0 auto; line-height: 1.6; }

        .layout-grid {
            display: grid;
            grid-template-columns: 1fr 340px;
            gap: 2rem;
            margin-top: 3rem;
        }

        @media (max-width: 1100px) {
            .layout-grid { grid-template-columns: 1fr; }
        }

        /* Interactive Tools */
        .tool-panel {
            background: white;
            padding: 2.5rem;
            border-radius: 16px;
            margin: 2rem 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.02);
            border: 1px solid #f1f5f9;
        }

        #chartdiv {
            width: 100%;
            height: 500px;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            margin: 1.5rem 0;
            background: #edf7fa;
        }

        .tools-controls {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            align-items: center;
        }

        .tools-controls select {
            padding: 0.75rem 1rem;
            border-radius: 8px;
            border: 1px solid #cbd5e1;
            font-size: 1rem;
        }

        /* Sidebar Elements */
        .sidebar-box {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            border-top: 4px solid var(--primary);
        }
        .sidebar-box.bio { border-top-color: var(--accent); }

        .sidebar-box h3 { margin-top: 0; font-size: 1.1rem; border-bottom: 1px solid #eee; padding-bottom: 0.5rem; margin-bottom: 1rem; }
        .bio-img { width: 100%; border-radius: 8px; margin-bottom: 1rem; }

        /* General UI */
        .card { background: white; padding: 2.5rem; border-radius: 16px; margin-bottom: 2rem; box-shadow: 0 4px 6px rgba(0,0,0,0.02); }
        .callout { padding: 1.5rem; border-radius: 12px; margin-top: 1.5rem; display: flex; gap: 1rem; align-items: start; background: #eff6ff; border-left: 5px solid #3b82f6; }

        /* Quiz Styles */
        .quiz-container { background: #f1f5f9; padding: 2rem; border-radius: 16px; margin-top: 3rem; }
        .option { background: white; padding: 1rem; border-radius: 8px; border: 2px solid #e2e8f0; cursor: pointer; margin-bottom: 0.75rem; transition: 0.2s; }
        .option:hover { border-color: var(--primary); }
        .option.correct { border-color: var(--success); background: #ecfdf5; }
        .option.wrong { border-color: var(--accent); background: #fff1f2; }
    </style>
</head>
<body>

    <header class="hero-chapter">
        <div class="container">
            <span class="chapter-badge">Chapter 03</span>
            <h1>Geodesy & Projections</h1>
            <p class="subtitle">Flattening a curved Earth is a mathematical impossibility. Learn why every map is a compromise and how to choose the right one for your work.</p>
        </div>
    </header>

    <main class="container">
        <nav style="margin: 2rem 0;">
            <a href="../index.html" style="text-decoration: none; color: var(--primary); font-weight: 600;">&larr; Back to Dashboard</a>
        </nav>

        <div class="layout-grid">
            <div class="content">
                <section class="card">
                    <h2>üåç The Fundamental Geodetic Challenge</h2>
                    <p>The Earth is not a perfect sphere; it's an <strong>oblate spheroid</strong> (bulging at the equator) with a bumpy, <strong>geoid</strong> surface. To map it, we must first model it using a <strong>Datum</strong>.</p>
                    
                    <div class="video-container" style="margin: 2rem 0; position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; border-radius: 12px; box-shadow: var(--shadow-lg);">
                        <iframe 
                            style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0;"
                            src="https://www.youtube.com/embed/LN_tCKdl9cE" 
                            title="Introduction to Map Projections" 
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                            allowfullscreen>
                        </iframe>
                    </div>

                    <div class="callout">
                        <strong>The "Orange Peel" Problem:</strong> Try peeling an orange and flattening the skin. You'll find it impossible without tearing it or stretching the surface. Every map projection does exactly this to our planet.
                    </div>
                </section>

                <section class="tool-panel">
                    <h2>Interactive Projection Explorer</h2>
                    <p>Toggle between different mathematical projections to see how the shapes and sizes of continents change. Watch <strong>Greenland</strong> closely ‚Äî it's the classic victim of map distortion!</p>
                    
                    <div class="tools-controls">
                        <input id="selector-prev" type="button" value="&larr;" onclick="setIndex(-1);" disabled="disabled" />
                        <select id="selector" onchange="setProjection(this.options[this.selectedIndex].value);">
                            <option value="geoMercator">Mercator (Navigation)</option>
                            <option value="geoRobinson">Robinson (Compromise)</option>
                            <option value="geoMollweide">Mollweide (Equal Area)</option>
                            <option value="geoOrthographic">Orthographic (Globe View)</option>
                            <option value="geoNaturalEarth1">Natural Earth</option>
                            <option value="geoAzimuthalEqualArea">Azimuthal Equal Area</option>
                            <option value="geoEquirectangular">Equirectangular (Plate Carr√©e)</option>
                        </select>
                        <input id="selector-next" type="button" value="&rarr;" onclick="setIndex(1);" />
                    </div>

                    <div id="chartdiv"></div>
                </section>

                <section class="card">
                    <h2>The "Big Four" Distortions</h2>
                    <p>When you flatten the Earth, you must sacrifice one or more of these properties. A projection can be:</p>
                    <ul style="line-height: 2;">
                        <li><strong>Conformal:</strong> Preserves <strong>Shapes</strong> (essential for local surveying).</li>
                        <li><strong>Equivalent:</strong> Preserves <strong>Area</strong> (essential for thematic maps of population).</li>
                        <li><strong>Equidistant:</strong> Preserves <strong>Distance</strong> (measured from one or two points).</li>
                        <li><strong>Azimuthal:</strong> Preserves <strong>Direction</strong> (important for flight paths).</li>
                    </ul>
                </section>

                <section class="card">
                    <h2>Summary of Big Ideas</h2>
                    <ul style="line-height: 1.8;">
                        <li><strong>Geodesy</strong> is the science of measuring Earth's shape.</li>
                        <li>A <strong>Datum</strong> (like WGS84) is a mathematical reference for coordinates.</li>
                        <li><strong>Coordinate Systems</strong> can be Geographic (lat/long) or Projected (meters/feet).</li>
                        <li>The <strong>Mercator</strong> projection is perfect for sailing but terrible for comparing country sizes.</li>
                    </ul>
                </section>

                <div class="quiz-container">
                    <h2>Chapter 03 Checkpoint</h2>
                    <div class="question">
                        <p><strong>1. Which projection is the "standard" used by most web maps (Google Maps, Leaflet)?</strong></p>
                        <div class="option" onclick="this.classList.add('correct')">Web Mercator</div>
                        <div class="option" onclick="this.classList.add('wrong')">Robinson</div>
                    </div>
                    <div class="question">
                        <p><strong>2. If you are making a map of "Total Forest Cover" where comparing sizes is crucial, which type of projection should you use?</strong></p>
                        <div class="option" onclick="this.classList.add('wrong')">Conformal</div>
                        <div class="option" onclick="this.classList.add('correct')">Equal Area (Equivalent)</div>
                    </div>
                </div>

                <section class="card" style="margin-top: 3rem;">
                    <h2>üìö Glossary</h2>
                    <dl>
                        <dt><strong>Geoid:</strong></dt>
                        <dd>The shape the ocean surface would take under the influence of gravity and Earth's rotation alone.</dd>
                        
                        <dt><strong>Standard Parallel:</strong></dt>
                        <dd>The line of latitude where the projection surface touches the globe; distortion is zero here.</dd>
                        
                        <dt><strong>Rhumb Line:</strong></dt>
                        <dd>A line on a map with a constant compass bearing (straight on Mercator).</dd>
                    </dl>
                </section>
            </div>

            <aside class="sidebar">
                <div class="sidebar-box bio">
                    <h3>Important Person</h3>
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/0b/Gerardus_Mercator.jpg/220px-Gerardus_Mercator.jpg" alt="Mercator" class="bio-img">
                    <p><strong>Gerardus Mercator (1512‚Äì1594)</strong></p>
                    <p>Flemish cartographer and geographer. In 1569, he introduced the Mercator projection, which became the standard for nautical navigation because it preserved constant bearings (rhumb lines). While controversial today for its area distortion, it remains the foundation of web mapping.</p>
                </div>

                <div class="sidebar-box local">
                    <h3>Local to Global</h3>
                    <p><strong>The Texas State Plane System</strong></p>
                    <p>Texas is massive. To minimize distortion for local surveying, the state is divided into <strong>5 zones</strong> (North, North Central, Central, South Central, South) within the State Plane Coordinate System (SPCS). Each zone uses a customized projection centered on that area.</p>
                    <p>Surveyors in Austin use the <strong>Texas Central Zone</strong> (FIPS 4203) for maximum precision!</p>
                </div>
            </aside>
        </div>

        <div class="chapter-nav" style="display: flex; justify-content: space-between; margin-top: 4rem; padding-top: 2rem; border-top: 1px solid #ddd;">
          <a href="chapter-02-map-design.html" style="text-decoration: none; color: var(--secondary);">&larr; Chapter 02: Map Design</a>
          <a href="chapter-04-gps.html" style="text-decoration: none; color: var(--primary); font-weight: 700;">Chapter 04: GNSS & Positioning &rarr;</a>
        </div>
    </main>

    <footer style="margin-top: 4rem; padding: 3rem 0; background: #f1f5f9; text-align: center;">
        <div class="container">
            <p>&copy; 2026 Dr. Moulay Anwar Sounny-Slitine. All Rights Reserved.</p>
        </div>
    </footer>

    <!-- amCharts & D3 Resources -->
    <script src="https://cdn.amcharts.com/lib/5/index.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/map.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/geodata/worldLow.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>
    <script src="https://d3js.org/d3-array.v1.min.js"></script>
    <script src="https://d3js.org/d3-geo.v1.min.js"></script>
    <script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>

    <script>
        var root, chart;
        am5.ready(function() {
            root = am5.Root.new("chartdiv");
            root.setThemes([ am5themes_Animated.new(root) ]);
            chart = root.container.children.push( am5map.MapChart.new(root, {
                panX: "translateX",
                panY: "translateY",
                projection: am5map.geoMercator()
            }));

            var polygonSeries = chart.series.push( am5map.MapPolygonSeries.new(root, {
                geoJSON: am5geodata_worldLow,
                fill: am5.color(0x6366f1),
                stroke: am5.color(0xffffff)
            }));

            var graticuleSeries = chart.series.insertIndex(0, am5map.GraticuleSeries.new(root, {}));
            graticuleSeries.mapLines.template.setAll({ stroke: am5.color(0x000000), strokeOpacity: 0.1 });

            setProjection("geoMercator");
        });

        window.setProjection = function(name) {
            if(chart) { chart.set("projection", d3[name].call(this)); chart.goHome(); }
            setButtonState();
        }

        window.setIndex = function(offset) {
            var s = document.getElementById("selector");
            var i = s.selectedIndex + offset;
            if (i >= 0 && i < s.options.length) {
                s.selectedIndex = i;
                setProjection(s.options[i].value);
            }
        }

        function setButtonState() {
            var s = document.getElementById("selector");
            document.getElementById("selector-prev").disabled = (s.selectedIndex == 0);
            document.getElementById("selector-next").disabled = (s.selectedIndex == s.options.length - 1);
        }
    </script>
</body>
</html>
