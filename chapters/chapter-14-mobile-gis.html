<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chapter 14: Mobile GIS & Field Data | GIS Digital Textbook</title>
    <meta
      name="description"
      content="Learn about Mobile GIS, Field Data Collection, and designing survey forms (Survey123/Field Maps). Collect data in the browser!"
    />
    <link rel="stylesheet" href="../css/style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>
    <style>
      /* Chapter-specific styles */
      .hero-chapter {
        background: linear-gradient(135deg, #16a085 0%, #2c3e50 100%);
        padding: 4rem 2rem;
        text-align: center;
        position: relative;
        overflow: hidden;
      }

      .hero-chapter::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        /* Mobile phone pattern */
        background-image: 
          radial-gradient(circle, rgba(255,255,255,0.1) 2px, transparent 2px);
        background-size: 20px 20px;
        opacity: 0.3;
      }

      .chapter-badge {
        display: inline-block;
        background: linear-gradient(135deg, #2ecc71, #27ae60);
        color: white;
        padding: 0.5rem 1.5rem;
        border-radius: 30px;
        font-size: 0.9rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.15em;
        margin-bottom: 1.5rem;
        box-shadow: 0 4px 15px rgba(46, 204, 113, 0.4);
        position: relative;
        z-index: 1;
      }

      .hero-chapter h1 {
        position: relative;
        z-index: 1;
        font-size: clamp(2.5rem, 5vw, 4rem);
        margin-bottom: 1rem;
        background: linear-gradient(135deg, #ffffff 0%, #a2d9ce 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        text-shadow: 0 4px 10px rgba(0,0,0,0.5);
      }

      /* Collector Tool */
      .collector-tool {
        display: grid;
        grid-template-columns: 350px 1fr;
        gap: 0;
        height: 600px;
        background: white;
        border-radius: 16px;
        overflow: hidden;
        border: 1px solid #ddd;
        margin: 2rem 0;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      }

      @media (max-width: 900px) {
        .collector-tool {
          grid-template-columns: 1fr;
          height: auto;
        }
      }

      .phone-interface {
        background: #f0f2f5;
        border-right: 1px solid #ddd;
        display: flex;
        flex-direction: column;
        padding: 1rem;
      }
      
      .phone-screen {
        background: white;
        border-radius: 20px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        flex: 1;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        border: 8px solid #333;
      }
      
      .screen-header {
        background: #27ae60;
        color: white;
        padding: 1rem;
        text-align: center;
        font-weight: bold;
      }

      .form-content {
        padding: 1rem;
        flex: 1;
        overflow-y: auto;
      }

      .form-group {
        margin-bottom: 1rem;
      }
      
      .form-label {
        display: block;
        margin-bottom: 0.5rem;
        font-size: 0.9rem;
        color: #555;
        font-weight: 600;
      }
      
      .form-input {
        width: 100%;
        padding: 0.75rem;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-size: 1rem;
      }
      
      .geo-btn {
        width: 100%;
        padding: 1rem;
        background: #eee;
        border: 2px dashed #ccc;
        border-radius: 6px;
        color: #555;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
      }
      
      .geo-btn.captured {
        background: #e8f8f5;
        border-color: #2ecc71;
        color: #27ae60;
      }

      .submit-btn {
        background: #2ecc71;
        color: white;
        border: none;
        padding: 1rem;
        width: 100%;
        font-weight: bold;
        cursor: pointer;
        margin-top: 1rem;
        border-radius: 6px;
      }

      .map-area {
        position: relative;
        background: #eee;
        z-index: 0;
      }

      #map {
        width: 100%;
        height: 100%;
      }

      .data-table-container {
        margin-top: 2rem;
        overflow-x: auto;
      }

      table.data-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.9rem;
      }
      
      table.data-table th, table.data-table td {
        padding: 0.75rem;
        border: 1px solid #eee;
        text-align: left;
      }
      
      table.data-table th {
        background: #2c3e50;
        color: white;
      }

      .workflow-steps {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 2rem;
        margin: 2rem 0;
      }

      .step {
        text-align: center;
        padding: 1.5rem;
        background: #f8f9fa;
        border-radius: 12px;
      }

      .step-icon {
        font-size: 2.5rem;
        display: block;
        margin-bottom: 1rem;
      }
    </style>
  </head>
  <body>
    <header class="hero-chapter">
      <div class="container">
        <span class="chapter-badge">Chapter 14</span>
        <h1>Mobile GIS & Field Data</h1>
        <p class="subtitle">
          Taking GIS into the wild. Learn how to transform a smartphone into a precision data collection tool.
        </p>
      </div>
    </header>

    <main class="container">
      <nav style="margin: 2rem 0;">
        <a href="../index.html" style="color: var(--accent);">‚Üê Back to Textbook</a>
      </nav>

      <section class="card">
        <h2>üì± The Field Workflow</h2>
        <p>
          Before Mobile GIS, field workers used paper clipboards and handwritten notes, which had to be manually typed into the computer later. 
          Today, we use apps like <strong>ArcGIS Field Maps</strong> and <strong>Survey123</strong> to collect digital data directly.
        </p>
        
        <div class="workflow-steps">
          <div class="step">
            <span class="step-icon">üíª</span>
            <h3>1. Design</h3>
            <p>Create the data schema and form in the office (Desktop/Web).</p>
          </div>
          <div class="step">
            <span class="step-icon">‚òÅÔ∏è</span>
            <h3>2. Publish</h3>
            <p>Share the map as a Web Map or Feature Service.</p>
          </div>
          <div class="step">
            <span class="step-icon">üì±</span>
            <h3>3. Collect</h3>
            <p>Go outside! Use the mobile app to capture points and photos.</p>
          </div>
          <div class="step">
            <span class="step-icon">üîÑ</span>
            <h3>4. Sync</h3>
            <p>Data automatically appears in the office GIS in real-time.</p>
          </div>
        </div>
      </section>

      <section class="card">
        <h2>üõ†Ô∏è Interactive Collector Simulator</h2>
        <p>
          Try it yourself! Imagine you are mapping <strong>Campus Trees</strong>. 
          <br>1. Use the "Phone" on the left to fill out details.
          <br>2. Click the specific button to "Capture Location" (then click on the Map).
          <br>3. Submit to see your data populate the database.
        </p>

        <div class="collector-tool">
          <div class="phone-interface">
            <div class="phone-screen">
              <div class="screen-header">
                Tree Inventory Survey
              </div>
              <div class="form-content">
                <div class="form-group">
                  <label class="form-label">Tree Species</label>
                  <select class="form-input" id="speciesInput">
                    <option value="Oak">Live Oak</option>
                    <option value="Pine">Slash Pine</option>
                    <option value="Palm">Sabal Palm</option>
                    <option value="Maple">Red Maple</option>
                  </select>
                </div>
                
                <div class="form-group">
                  <label class="form-label">Health Status</label>
                  <select class="form-input" id="healthInput">
                    <option value="Good">Good</option>
                    <option value="Fair">Fair</option>
                    <option value="Poor">Poor/Dead</option>
                  </select>
                </div>
                
                <div class="form-group">
                  <label class="form-label">Location</label>
                  <button class="geo-btn" id="captureBtn" onclick="activateCapture()">
                    <span id="geoIcon">üìç</span> <span id="geoText">Set Location on Map</span>
                  </button>
                </div>

                <div class="form-group">
                   <label class="form-label">Notes</label>
                   <input type="text" class="form-input" id="notesInput" placeholder="Optional notes...">
                </div>

                <button class="submit-btn" onclick="submitForm()">Submit Entry</button>
              </div>
            </div>
          </div>
          
          <div class="map-area">
            <div id="map"></div>
          </div>
        </div>

        <div class="data-table-container">
          <h3>Collected Data (Attribute Table)</h3>
          <p style="color: #666; font-size: 0.9rem;">This simulates the "Feature Layer" that fills up in the cloud.</p>
          <table class="data-table" id="dataTable">
            <thead>
              <tr>
                <th>FID</th>
                <th>Species</th>
                <th>Health</th>
                <th>Latitude</th>
                <th>Longitude</th>
                <th>Notes</th>
              </tr>
            </thead>
            <tbody>
              <!-- Rows added via JS -->
            </tbody>
          </table>
        </div>
      </section>

      <div class="chapter-nav" style="display: flex; justify-content: space-between; margin-top: 3rem;">
        <a href="chapter-13-spatial-modeling.html" style="text-decoration: none; padding: 1rem 2rem; border-radius: 8px; background: #eee; color: #333;">‚Üê Chapter 13</a>
        <a href="chapter-15-storytelling.html" style="text-decoration: none; padding: 1rem 2rem; border-radius: 8px; background: #e91e63; color: white;">Next: Storytelling with Maps ‚Üí</a>
      </div>
    </main>

    <footer>
      <div class="container">
        <p>&copy; 2026 Dr. Moulay Anwar Sounny-Slitine</p>
        <p style="margin-top: 0.5rem; font-size: 0.85rem; opacity: 0.7;">
          GIS Digital Textbook | Open Educational Resource
        </p>
      </div>
    </footer>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
    <script>
      // Map Init
      const map = L.map('map').setView([29.6516, -82.3248], 15); // UF Campus Coordinates

      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
      }).addTo(map);

      let captureMode = false;
      let currentMarker = null;
      let capturedLatLng = null;
      let records = [];
      let fidCounter = 1;

      const captureBtn = document.getElementById('captureBtn');
      const geoText = document.getElementById('geoText');

      function activateCapture() {
        captureMode = true;
        map.getContainer().style.cursor = 'crosshair';
        geoText.textContent = "Click on Map to Place Point...";
        captureBtn.style.background = '#fff3cd';
      }

      map.on('click', function(e) {
        if (!captureMode) return;

        // Remove old temp marker if any
        if (currentMarker) {
          map.removeLayer(currentMarker);
        }

        currentMarker = L.marker(e.latlng).addTo(map);
        capturedLatLng = e.latlng;
        
        // Update UI
        captureMode = false;
        map.getContainer().style.cursor = '';
        geoText.textContent = `Lat: ${e.latlng.lat.toFixed(4)}, Lon: ${e.latlng.lng.toFixed(4)}`;
        captureBtn.classList.add('captured');
      });

      function submitForm() {
        if (!capturedLatLng) {
          alert("Please capture a location on the map first!");
          return;
        }

        const species = document.getElementById('speciesInput').value;
        const health = document.getElementById('healthInput').value;
        const notes = document.getElementById('notesInput').value;

        // Add to Table
        const tbody = document.querySelector('#dataTable tbody');
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${fidCounter}</td>
          <td>${species}</td>
          <td>${health}</td>
          <td>${capturedLatLng.lat.toFixed(5)}</td>
          <td>${capturedLatLng.lng.toFixed(5)}</td>
          <td>${notes}</td>
        `;
        tbody.prepend(row); // Add to top

        // Reset Form
        fidCounter++;
        document.getElementById('notesInput').value = '';
        captureBtn.classList.remove('captured');
        geoText.textContent = "Set Location on Map";
        capturedLatLng = null;
        currentMarker = null; // Keep point on map? Or clear? 
        // In real app, points stay. Let's keep a permanent marker.
        L.circleMarker(currentMarker.getLatLng(), {
          color: '#2ecc71',
          fillColor: '#2ecc71',
          fillOpacity: 0.5,
          radius: 8
        }).bindPopup(`<b>${species}</b><br>${health}`).addTo(map);

        alert("Data successfully synced to attribute table!");
      }
    </script>
  </body>
</html>
