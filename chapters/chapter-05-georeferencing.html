<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 05: Georeferencing | GIS Digital Textbook</title>
    <meta name="description" content="Learn how to give life to paper maps. Master control points, RMS errors, and the process of georeferencing historical imagery into a modern GIS coordinate system.">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root {
            --primary: #0891b2;
            --secondary: #64748b;
            --accent: #f59e0b;
            --success: #10b981;
            --bg: #f8fafc;
        }

        .hero-chapter {
            background: linear-gradient(135deg, #0e7490 0%, #0891b2 100%);
            padding: 5rem 2rem;
            text-align: center;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .hero-chapter::before {
            content: "";
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background-image: 
                linear-gradient(rgba(255,255,255,0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255,255,255,0.05) 1px, transparent 1px);
            background-size: 50px 50px;
        }

        .chapter-badge {
            display: inline-block;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(4px);
            padding: 0.5rem 1.5rem;
            border-radius: 999px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 1.5rem;
            border: 1px solid rgba(255,255,255,0.3);
        }

        h1 { font-size: clamp(2.5rem, 5vw, 4rem); margin-bottom: 1rem; }
        .subtitle { font-size: 1.25rem; opacity: 0.9; max-width: 800px; margin: 0 auto; line-height: 1.6; }

        .layout-grid {
            display: grid;
            grid-template-columns: 1fr 340px;
            gap: 2rem;
            margin-top: 3rem;
        }

        @media (max-width: 1100px) {
            .layout-grid { grid-template-columns: 1fr; }
        }

        .sidebar-box {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            border-top: 4px solid var(--primary);
        }
        .sidebar-box.bio { border-top-color: var(--accent); }

        .sidebar-box h3 { margin-top: 0; font-size: 1.1rem; border-bottom: 1px solid #eee; padding-bottom: 0.5rem; margin-bottom: 1rem; }
        .bio-img { width: 100%; border-radius: 8px; margin-bottom: 1rem; }

        .card { background: white; padding: 2.5rem; border-radius: 16px; margin-bottom: 2rem; box-shadow: 0 4px 6px rgba(0,0,0,0.02); }
        
        /* Interactive Georeferencer Overlay Simple Sim */
        .georef-sim {
            background: #1e293b;
            color: #f8fafc;
            padding: 2rem;
            border-radius: 16px;
            margin: 2rem 0;
            text-align: center;
        }

        .preview-box {
            width: 100%;
            height: 300px;
            background: #334155;
            border-radius: 12px;
            position: relative;
            overflow: hidden;
            margin: 1.5rem 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .scanned-map {
            width: 200px;
            height: 200px;
            background: #fef3c7;
            border: 2px solid #b45309;
            color: #b45309;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            cursor: move;
            position: absolute;
            opacity: 0.8;
            transition: transform 0.1s;
        }

        .basemap-viz {
            width: 100%;
            height: 100%;
            opacity: 0.3;
            background-image: radial-gradient(#64748b 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .control-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        /* Quiz Styles */
        .quiz-container { background: #f1f5f9; padding: 2rem; border-radius: 16px; margin-top: 3rem; }
        .option { background: white; padding: 1rem; border-radius: 8px; border: 2px solid #e2e8f0; cursor: pointer; margin-bottom: 0.75rem; transition: 0.2s; color: #1e293b; }
        .option:hover { border-color: var(--primary); }
        .option.correct { border-color: var(--success); background: #ecfdf5; }
        .option.wrong { border-color: #ef4444; background: #fff1f2; }
    </style>
</head>
<body>

    <header class="hero-chapter">
        <div class="container">
            <span class="chapter-badge">Chapter 05</span>
            <h1>Georeferencing</h1>
            <p class="subtitle">Assigning coordinates to images. Learn how to transform scanned paper maps and historical aerial photos into accurate spatial data.</p>
        </div>
    </header>

    <main class="container">
        <nav style="margin: 2rem 0;">
            <a href="../index.html" style="text-decoration: none; color: var(--primary); font-weight: 600;">&larr; Back to Dashboard</a>
        </nav>

        <div class="layout-grid">
            <div class="content">
                <section class="card">
                    <h2>What is Georeferencing?</h2>
                    <p>Georeferencing is the process of defining the internal coordinate system of a digital map or aerial photo so it can be associated with a real-world coordinate system. Effectively, you are "nailing" a flat image onto the curved surface of the Earth.</p>
                    
                    <div class="callout" style="background: #ecfdf5; border-left: 5px solid #10b981; color: #065f46; display: flex; gap: 1rem; align-items: start; padding: 1.5rem; border-radius: 12px; margin-top: 1.5rem;">
                        <div><strong>ðŸ”‘ Key Goal:</strong> To take data that doesn't "know" where it is and give it a spatial context so it can be used alongside other GIS layers.</div>
                    </div>
                </section>

                <section class="card">
                    <h2>Ground Control Points (GCPs)</h2>
                    <p>To georeference an image, we use <strong>Ground Control Points</strong>. These are locations on the scanned map that can be accurately identified on a modern, georeferenced base map (like street intersections or building corners).</p>
                    
                    <ul style="line-height: 2; margin-top: 1rem;">
                        <li><strong>1 Point:</strong> Can move the map (Translation).</li>
                        <li><strong>2 Points:</strong> Can move and rotate the map.</li>
                        <li><strong>3+ Points:</strong> Can scale, warp, and skew the map (Affine Transformation).</li>
                    </ul>
                </section>

                <section class="georef-sim">
                    <h3>Simulated Alignment</h3>
                    <p>Use the sliders to manually align this "Scanned Map" (Yellow) with the "Base Map" (Grid).</p>
                    
                    <div class="preview-box">
                        <div class="basemap-viz"></div>
                        <div class="scanned-map" id="targetMap">ðŸ“œ Scanned Data</div>
                    </div>

                    <div class="control-panel">
                        <div>
                            <label>X Position</label>
                            <input type="range" min="-100" max="100" value="0" id="posX" style="width:100%;">
                        </div>
                        <div>
                            <label>Rotation</label>
                            <input type="range" min="0" max="360" value="0" id="rot" style="width:100%;">
                        </div>
                    </div>
                </section>

                <section class="card">
                    <h2>Measuring Error: RMS</h2>
                    <p>No georeferenced map is perfectly aligned. We measure the "goodness of fit" using <strong>Root Mean Square (RMS) Error</strong>. This value represents the average distance between where you placed a point and where the mathematical model says it should be.</p>
                    
                    <div class="callout" style="background: #fffbeb; border-left: 5px solid #f59e0b; color: #92400e; padding: 1.5rem; border-radius: 12px; margin-top: 1.5rem;">
                        <strong>Pro Tip:</strong> High RMS error? Check your points! A single "mis-clicked" point can ruin the whole transformation. Professionals often look for the <em>Residual</em> of each point to find the culprits.
                    </div>
                </section>

                <section class="card">
                    <h2>Summary of Big Ideas</h2>
                    <ul style="line-height: 1.8;">
                        <li><strong>Georeferencing</strong> links historical or non-spatial images to Earth's coordinates.</li>
                        <li><strong>GCPs</strong> are the link between the unknown (raster) and the known (basemap).</li>
                        <li><strong>Transformation Models</strong> (1st, 2nd, 3rd Order) determine how the image is warped.</li>
                        <li><strong>World Files</strong> (.tfw, .jgw) store the coordinates and scaling data for georeferenced images.</li>
                    </ul>
                </section>

                <div class="quiz-container">
                    <h2>Chapter 05 Checkpoint</h2>
                    <div class="question">
                        <p><strong>1. What is the minimum number of Ground Control Points (GCPs) required for an Affine (1st Order) transformation?</strong></p>
                        <div class="option" onclick="this.classList.add('wrong')">1</div>
                        <div class="option" onclick="this.classList.add('correct')">3</div>
                    </div>
                    <div class="question">
                        <p><strong>2. If your RMS error is very high, what is the most likely cause?</strong></p>
                        <div class="option" onclick="this.classList.add('correct')">One or more GCPs were placed inaccurately.</div>
                        <div class="option" onclick="this.classList.add('wrong')">You used too many points.</div>
                    </div>
                </div>

                <section class="card" style="margin-top: 3rem;">
                    <h2>Glossary</h2>
                    <dl>
                        <dt><strong>Residual:</strong></dt>
                        <dd>The distance between the actual location of a GCP and its estimated location after transformation.</dd>
                        
                        <dt><strong>Orthorectification:</strong></dt>
                        <dd>A process that removes the effects of image tilt and terrain relief from aerial photos.</dd>
                        
                        <dt><strong>World File:</strong></dt>
                        <dd>A small text file used by GIS software to read the georeferencing info of a raster image.</dd>
                    </dl>
                </section>
            </div>

            <aside class="sidebar">
                <div class="sidebar-box bio">
                    <h3>Important Person</h3>
                    <img src="https://www.usgs.gov/sites/default/files/styles/side_image/public/images/john_snow.jpg" alt="Historical Cartography" class="bio-img">
                    <p><strong>The Early Aligners</strong></p>
                    <p>While modern georeferencing is digital, the desire to overlay maps dates back centuries. Early cartographers would literally use transparent paper and sunlight to align "overlays" of different city plansâ€”a precursor to the mathematical georeferencing tools we use today in software like QGIS or ArcGIS.</p>
                </div>

                <div class="sidebar-box local">
                    <h3>Local to Global</h3>
                    <p><strong>Retro-mapping Austin</strong></p>
                    <p>The University of Texas at Austin provides an <em>Historical Map Collection</em> containing prints from the 1800s. By georeferencing these maps over modern satellite imagery of the "Drag" (Guadalupe St), researchers can track how buildings and drainage patterns have changed over 150 years.</p>
                    <p>This process is essential for environmental impact studies and historical preservation.</p>
                </div>
            </aside>
        </div>

        <div class="chapter-nav" style="display: flex; justify-content: space-between; margin-top: 4rem; padding-top: 2rem; border-top: 1px solid #ddd;">
          <a href="chapter-04-gps.html" style="text-decoration: none; color: var(--secondary);">&larr; Chapter 04: GNSS</a>
          <a href="chapter-06-digitizing.html" style="text-decoration: none; color: var(--primary); font-weight: 700;">Chapter 06: Digitizing &rarr;</a>
        </div>
    </main>

    <footer style="margin-top: 4rem; padding: 3rem 0; background: #f1f5f9; text-align: center;">
        <div class="container">
            <p>&copy; 2026 Dr. Moulay Anwar Sounny-Slitine. All Rights Reserved.</p>
        </div>
    </footer>

    <script>
        const target = document.getElementById('targetMap');
        const posX = document.getElementById('posX');
        const rot = document.getElementById('rot');

        function update() {
            target.style.transform = `translate(${posX.value}px, 0) rotate(${rot.value}deg)`;
        }

        posX.addEventListener('input', update);
        rot.addEventListener('input', update);
    </script>
</body>
</html>
